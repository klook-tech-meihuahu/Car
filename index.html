<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¼€å‘è€…è¶…çº§å·¥å…·ç®± - DevToolkit</title>
  
  <!-- å¼•å…¥ React å’Œ ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  
  <!-- å¼•å…¥ Babel ç”¨äºåœ¨æµè§ˆå™¨ä¸­ç¼–è¯‘ JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- å¼•å…¥ Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- å¼•å…¥ FontAwesome å›¾æ ‡åº“ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* è‡ªå®šä¹‰äº®è‰²ç³»æ»šåŠ¨æ¡ */
    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f8fafc;
      border-radius: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
    /* éšè—æœªç¼–è¯‘çš„ React ä»£ç ï¼Œé˜²æ­¢é¡µé¢é—ªçƒ */
    script[type="text/babel"] {
      display: none;
    }
    body {
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased selection:bg-blue-200">
  
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- å®ç”¨å·¥å…·å‡½æ•° ---

    const copyToClipboard = (text, onSuccess, onError) => {
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(onSuccess).catch(onError);
      } else {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.left = "-999999px";
        textArea.style.top = "-999999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
          document.execCommand('copy');
          onSuccess();
        } catch (err) {
          onError();
        }
        textArea.remove();
      }
    };

    const generateJavaClass = (jsonStr, rootClassName = "RootEntity") => {
      let obj;
      try {
        obj = JSON.parse(jsonStr);
      } catch (e) {
        throw new Error("æ— æ•ˆçš„ JSON æ ¼å¼ï¼Œè¯·æ£€æŸ¥åå†è¯•");
      }

      const classes = {};
      const capitalize = (s) => s.charAt(0).toUpperCase() + s.slice(1);

      const parseObject = (name, data) => {
        if (data === null) return "Object";
        if (Array.isArray(data)) {
          if (data.length === 0) return "List<Object>";
          const itemType = parseObject(name.endsWith('s') ? name.slice(0, -1) : name + "Item", data[0]);
          return `List<${itemType}>`;
        }
        if (typeof data === "object") {
          let fields = "";
          let className = capitalize(name);
          for (const key in data) {
            const type = parseObject(key, data[key]);
            fields += `    private ${type} ${key};\n`;
          }
          let classDef = `public class ${className} {\n\n${fields}\n    // çœç•¥ Getter å’Œ Setter\n}`;
          classes[className] = classDef;
          return className;
        }
        if (typeof data === "string") return "String";
        if (typeof data === "number") return Number.isInteger(data) ? "Integer" : "Double";
        if (typeof data === "boolean") return "Boolean";
        return "Object";
      };

      parseObject(rootClassName, obj);
      const imports = "import java.util.List;\n\n";
      return imports + Object.values(classes).join("\n\n");
    };

    const formatXml = (xml) => {
      let formatted = '';
      let pad = 0;
      let tempXml = xml.replace(/(>)(<)(\/*)/g, '$1\n$2$3');
      tempXml.split('\n').forEach((line) => {
        let indent = 0;
        if (line.match(/.+<\/\w[^>]*>$/)) {
          indent = 0;
        } else if (line.match(/^<\/\w/)) {
          if (pad !== 0) pad -= 1;
        } else if (line.match(/^<\w[^>]*[^\/]>.*$/)) {
          indent = 1;
        } else {
          indent = 0;
        }
        formatted += '  '.repeat(pad) + line + '\n';
        pad += indent;
      });
      return formatted.trim();
    };

    const minifyXml = (xml) => {
      return xml.replace(/>\s+</g, '><').replace(/\r?\n|\r/g, '').trim();
    };

    const computeDiff = (oldStr, newStr, type = 'json') => {
      try {
        let linesA, linesB;
        if (type === 'json') {
          linesA = JSON.stringify(JSON.parse(oldStr), null, 2).split('\n');
          linesB = JSON.stringify(JSON.parse(newStr), null, 2).split('\n');
        } else if (type === 'xml') {
          linesA = formatXml(oldStr).split('\n');
          linesB = formatXml(newStr).split('\n');
        } else {
          linesA = oldStr.split('\n');
          linesB = newStr.split('\n');
        }
        
        if (linesA.length * linesB.length > 4000000) {
          return [{ type: 'error', value: 'æ•°æ®è¿‡å¤§ï¼Œæ— æ³•è¿›è¡Œç²¾ç»†å¯¹æ¯”' }];
        }

        const m = linesA.length, n = linesB.length;
        const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));
        
        for (let i = 1; i <= m; i++) {
          for (let j = 1; j <= n; j++) {
            if (linesA[i - 1] === linesB[j - 1]) dp[i][j] = dp[i - 1][j - 1] + 1;
            else dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
          }
        }
        
        let i = m, j = n;
        const result = [];
        while (i > 0 || j > 0) {
          if (i > 0 && j > 0 && linesA[i - 1] === linesB[j - 1]) {
            result.unshift({ type: 'unchanged', value: linesA[i - 1] });
            i--; j--;
          } else if (j > 0 && (i === 0 || dp[i][j - 1] >= dp[i - 1][j])) {
            result.unshift({ type: 'added', value: linesB[j - 1] });
            j--;
          } else if (i > 0 && (j === 0 || dp[i][j - 1] < dp[i - 1][j])) {
            result.unshift({ type: 'removed', value: linesA[i - 1] });
            i--;
          }
        }
        return result;
      } catch (e) {
        return [{ type: 'error', value: 'è§£æå¤±è´¥ï¼Œè¯·ç¡®ä¿ä¸¤è¾¹æ ¼å¼æ­£ç¡®' }];
      }
    };


    // --- UI ç»„ä»¶ ---

    const Toast = ({ message, type, onClose }) => {
      useEffect(() => {
        const timer = setTimeout(onClose, 2500);
        return () => clearTimeout(timer);
      }, [onClose]);

      const bgColors = {
        success: 'bg-green-100 border-green-400 text-green-800',
        error: 'bg-red-100 border-red-400 text-red-800',
        info: 'bg-blue-100 border-blue-400 text-blue-800'
      };
      
      const icons = {
        success: 'fa-circle-check text-green-600',
        error: 'fa-circle-exclamation text-red-600',
        info: 'fa-circle-info text-blue-600'
      };

      return (
        <div className={`fixed bottom-6 right-6 flex items-center px-4 py-3 rounded-lg border shadow-lg transition-all z-50 ${bgColors[type] || bgColors.info}`}>
          <i className={`fas ${icons[type] || icons.info} text-lg mr-2`}></i>
          <span className="text-sm font-medium">{message}</span>
        </div>
      );
    };

    const Button = ({ onClick, children, variant = 'primary', icon, className = "", isActive = false }) => {
      const baseStyle = "flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 shadow-sm";
      const variants = {
        primary: "bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500 border border-blue-600",
        secondary: "bg-white hover:bg-gray-50 text-gray-700 focus:ring-gray-200 border border-gray-300",
        danger: "bg-red-50 hover:bg-red-100 text-red-600 focus:ring-red-200 border border-red-200",
        outline: "bg-transparent hover:bg-gray-100 text-gray-600 focus:ring-gray-200 border border-gray-300",
      };

      const activeStyles = isActive 
        ? "ring-2 ring-offset-1 ring-blue-500 shadow-md transform scale-[0.98] !border-blue-500" + (variant === 'secondary' ? " bg-blue-50 text-blue-700" : "")
        : "";

      return (
        <button onClick={onClick} className={`${baseStyle} ${variants[variant]} ${activeStyles} ${className}`}>
          {icon && <i className={`fas fa-${icon} mr-2`}></i>}
          {children}
        </button>
      );
    };

    const TextAreaPanel = ({ label, value, onChange, placeholder, readOnly = false, extraAction = null }) => (
      <div className="flex flex-col h-full bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
        <div className="flex justify-between items-center px-4 py-2 bg-gray-50 border-b border-gray-200">
          <span className="text-xs font-semibold text-gray-500 uppercase tracking-wider">{label}</span>
          <div className="flex gap-2">
            {extraAction}
          </div>
        </div>
        <textarea
          className="flex-1 w-full bg-white text-gray-800 p-4 font-mono text-sm resize-none focus:outline-none custom-scrollbar"
          value={value}
          onChange={onChange}
          placeholder={placeholder}
          readOnly={readOnly}
          spellCheck="false"
        />
      </div>
    );

    // --- æ ¸å¿ƒåŠŸèƒ½æ¨¡å— ---

    const JsonToolkit = ({ showToast }) => {
      const [input, setInput] = useState('');
      const [output, setOutput] = useState('');
      const [activeAction, setActiveAction] = useState('format');

      // ç›‘å¬è¾“å…¥å’ŒåŠ¨ä½œå˜åŒ–ï¼Œè‡ªåŠ¨å¤„ç†
      useEffect(() => {
        if (!input.trim()) {
          setOutput('');
          return;
        }
        try {
          let res = '';
          switch (activeAction) {
            case 'format':
              res = JSON.stringify(JSON.parse(input), null, 4);
              break;
            case 'minify':
              res = JSON.stringify(JSON.parse(input));
              break;
            case 'escape':
              res = JSON.stringify(input).slice(1, -1);
              break;
            case 'unescape':
              let unescaped = input;
              if (unescaped.startsWith('"') && unescaped.endsWith('"')) {
                 unescaped = JSON.parse(unescaped);
              } else {
                 unescaped = JSON.parse(`"${unescaped}"`);
              }
              try { res = JSON.stringify(JSON.parse(unescaped), null, 4); } 
              catch(e) { res = unescaped; }
              break;
            default: break;
          }
          setOutput(res);
        } catch (err) {
          // ä»…åœ¨è¾“å‡ºåŒºæç¤ºä»¥å…æ‰“æ–­ç”¨æˆ·æ­£å¸¸è¾“å…¥
          setOutput(`// è§£æå¤±è´¥: ${err.message}\n// è¯·æ£€æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¡®...`);
        }
      }, [input, activeAction]);

      const handleActionClick = (action) => {
        setActiveAction(action);
        if (input.trim()) showToast(`å·²åˆ‡æ¢è‡³: ${action}`, "success");
      };

      return (
        <div className="flex flex-col h-full space-y-4">
          <div className="flex flex-wrap gap-3 p-1">
            <Button isActive={activeAction === 'format'} onClick={() => handleActionClick('format')} icon="align-left">æ ¼å¼åŒ– (Beautify)</Button>
            <Button isActive={activeAction === 'minify'} onClick={() => handleActionClick('minify')} icon="compress" variant="secondary">å‹ç¼© (Minify)</Button>
            <Button isActive={activeAction === 'escape'} onClick={() => handleActionClick('escape')} icon="arrow-right-arrow-left" variant="secondary">è½¬ä¹‰ (Escape)</Button>
            <Button isActive={activeAction === 'unescape'} onClick={() => handleActionClick('unescape')} icon="layer-group" variant="secondary">å»è½¬ä¹‰ (Unescape)</Button>
            <div className="flex-1"></div>
            <Button onClick={() => setInput('{\n  "demo": true,\n  "message": "Hello World"\n}')} variant="outline" icon="code">å¡«å…¥ç¤ºä¾‹</Button>
            <Button onClick={() => { setInput(''); setOutput(''); }} variant="danger" icon="trash-can">æ¸…ç©º</Button>
          </div>

          <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-4 min-h-0">
            <TextAreaPanel label="è¾“å…¥åŒº (Input)" value={input} onChange={(e) => setInput(e.target.value)} placeholder="ç²˜è´´æ‚¨çš„ JSON å­—ç¬¦ä¸²åˆ°è¿™é‡Œï¼Œå°†è‡ªåŠ¨å¤„ç†..." />
            <TextAreaPanel 
              label="è¾“å‡ºåŒº (Output)" 
              value={output} 
              readOnly 
              placeholder="å¤„ç†åçš„ç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ..."
              extraAction={
                <button onClick={() => copyToClipboard(output, () => showToast("å¤åˆ¶æˆåŠŸ", "success"), () => showToast("å¤åˆ¶å¤±è´¥", "error"))} className="text-gray-400 hover:text-blue-600 transition-colors" title="å¤åˆ¶ç»“æœ">
                  <i className="fas fa-copy"></i>
                </button>
              }
            />
          </div>
        </div>
      );
    };

    const XmlToolkit = ({ showToast }) => {
      const [input, setInput] = useState('');
      const [output, setOutput] = useState('');
      const [activeAction, setActiveAction] = useState('format');

      useEffect(() => {
        if (!input.trim()) {
          setOutput('');
          return;
        }
        try {
          let res = '';
          if (activeAction === 'format') {
            res = formatXml(input);
          } else if (activeAction === 'minify') {
            res = minifyXml(input);
          }
          setOutput(res);
        } catch (err) {
          setOutput(`<!-- è§£æå¤±è´¥: ${err.message} -->`);
        }
      }, [input, activeAction]);

      const handleActionClick = (action) => {
        setActiveAction(action);
        if (input.trim()) showToast(`å·²åˆ‡æ¢è‡³: ${action}`, "success");
      };

      return (
        <div className="flex flex-col h-full space-y-4">
          <div className="flex flex-wrap gap-3 p-1">
            <Button isActive={activeAction === 'format'} onClick={() => handleActionClick('format')} icon="align-left">æ ¼å¼åŒ– (Beautify)</Button>
            <Button isActive={activeAction === 'minify'} onClick={() => handleActionClick('minify')} icon="compress" variant="secondary">å‹ç¼© (Minify)</Button>
            <div className="flex-1"></div>
            <Button onClick={() => setInput('<note>\n<to>Tove</to>\n<from>Jani</from>\n<body>Don\'t forget me this weekend!</body>\n</note>')} variant="outline" icon="code">å¡«å…¥ç¤ºä¾‹</Button>
            <Button onClick={() => { setInput(''); setOutput(''); }} variant="danger" icon="trash-can">æ¸…ç©º</Button>
          </div>

          <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-4 min-h-0">
            <TextAreaPanel label="XML è¾“å…¥åŒº (Input)" value={input} onChange={(e) => setInput(e.target.value)} placeholder="ç²˜è´´æ‚¨çš„ XML å­—ç¬¦ä¸²åˆ°è¿™é‡Œï¼Œå°†è‡ªåŠ¨å¤„ç†..." />
            <TextAreaPanel 
              label="XML è¾“å‡ºåŒº (Output)" 
              value={output} 
              readOnly 
              placeholder="å¤„ç†åçš„ç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ..."
              extraAction={
                <button onClick={() => copyToClipboard(output, () => showToast("å¤åˆ¶æˆåŠŸ", "success"), () => showToast("å¤åˆ¶å¤±è´¥", "error"))} className="text-gray-400 hover:text-blue-600 transition-colors" title="å¤åˆ¶ç»“æœ">
                  <i className="fas fa-copy"></i>
                </button>
              }
            />
          </div>
        </div>
      );
    };

    const DiffTool = ({ showToast, mode = 'json' }) => {
      const [leftText, setLeftText] = useState('');
      const [rightText, setRightText] = useState('');
      const [diffRows, setDiffRows] = useState(null);
      const [isComparing, setIsComparing] = useState(false);
      const containerRef = useRef(null);

      const titleA = mode === 'json' ? 'åŸå§‹ JSON (A)' : 'åŸå§‹ XML (A)';
      const titleB = mode === 'json' ? 'ä¿®æ”¹å JSON (B)' : 'ä¿®æ”¹å XML (B)';
      const modeName = mode === 'json' ? 'JSON' : 'XML';

      const handleCompare = () => {
        if (!leftText.trim() || !rightText.trim()) {
          showToast(`è¯·åœ¨ä¸¤è¾¹éƒ½è¾“å…¥ ${modeName} å†…å®¹`, "error");
          return;
        }
        const result = computeDiff(leftText, rightText, mode);
        if (result.length > 0 && result[0].type === 'error') {
            showToast(result[0].value, "error");
            return;
        }

        // å°†ä¸€ç»´å·®å¼‚æ•°ç»„è½¬æ¢ä¸ºå·¦å³ä¸¤è¾¹å¯¹é½çš„è¡Œ
        const rows = [];
        let i = 0;
        let leftLineNum = 1;
        let rightLineNum = 1;

        while (i < result.length) {
            const current = result[i];
            if (current.type === 'unchanged') {
                rows.push({ 
                    left: current, right: current, 
                    leftNum: leftLineNum++, rightNum: rightLineNum++ 
                });
                i++;
            } else if (current.type === 'removed') {
                if (i + 1 < result.length && result[i+1].type === 'added') {
                    rows.push({ 
                        left: current, right: result[i+1],
                        leftNum: leftLineNum++, rightNum: rightLineNum++
                    });
                    i += 2;
                } else {
                    rows.push({ 
                        left: current, right: null,
                        leftNum: leftLineNum++, rightNum: ''
                    });
                    i++;
                }
            } else if (current.type === 'added') {
                rows.push({ 
                    left: null, right: current,
                    leftNum: '', rightNum: rightLineNum++
                });
                i++;
            }
        }
        setDiffRows(rows);
        setIsComparing(true);
      };

      // å¤„ç†å³ä¾§ Minimap å¯¼èˆªæ¡çš„ç‚¹å‡»è·³è½¬
      const handleMinimapClick = (e) => {
        if (!containerRef.current) return;
        const rect = e.currentTarget.getBoundingClientRect();
        const y = e.clientY - rect.top;
        const percentage = y / rect.height;
        // è®¡ç®—ç›®æ ‡æ»šåŠ¨ä½ç½®ï¼Œå¹¶å‡å»å¯è§†åŒºåŸŸçš„ä¸€åŠï¼Œè®©ç›®æ ‡å·®å¼‚å°½å¯èƒ½å±…ä¸­
        containerRef.current.scrollTop = (containerRef.current.scrollHeight * percentage) - (containerRef.current.clientHeight / 2);
      };

      return (
        <div className="flex flex-col h-full space-y-4">
          <div className="flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200 shadow-sm shrink-0">
            {!isComparing ? (
                <>
                    <Button onClick={handleCompare} icon="code-compare" variant="primary">å¼€å§‹æ™ºèƒ½å¯¹æ¯”</Button>
                    <p className="text-gray-500 text-sm ml-4 flex-1">æ”¯æŒæ™ºèƒ½æ ¼å¼åŒ–åå¯¹æ¯”ï¼Œå°†ä¸ºæ‚¨å±•ç¤ºç›´è§‚çš„å·¦å³åˆ†æ è§†å›¾ã€‚</p>
                    <Button onClick={() => { setLeftText(''); setRightText(''); setDiffRows(null); }} variant="danger" icon="trash-can">æ¸…ç©º</Button>
                </>
            ) : (
                <>
                    <Button onClick={() => setIsComparing(false)} icon="arrow-left" variant="secondary">è¿”å›ç¼–è¾‘</Button>
                    <p className="text-gray-500 text-sm ml-4 flex-1">
                        å¯¹æ¯”ç»“æœï¼š<span className="text-red-500">çº¢è‰²ä¸ºåˆ é™¤</span>ï¼Œ<span className="text-green-500">ç»¿è‰²ä¸ºæ–°å¢</span>ï¼Œ<span className="text-blue-500">è“è‰²ä¸ºä¿®æ”¹</span>ã€‚
                        <span className="font-semibold text-gray-700 ml-2">ğŸ‘‰ æç¤ºï¼šå¯ç‚¹å‡»æœ€å³ä¾§å¯¼èˆªæ¡å¿«é€Ÿè·³è½¬ã€‚</span>
                    </p>
                </>
            )}
          </div>

          {!isComparing ? (
            <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-4 min-h-[300px]">
              <TextAreaPanel label={titleA} value={leftText} onChange={(e) => setLeftText(e.target.value)} placeholder={`è¾“å…¥æ—§çš„ ${modeName}...`} />
              <TextAreaPanel label={titleB} value={rightText} onChange={(e) => setRightText(e.target.value)} placeholder={`è¾“å…¥æ–°çš„ ${modeName}...`} />
            </div>
          ) : (
            <div className="flex-1 relative flex bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm min-h-[300px]">
              {/* ä¸»ä»£ç å¯¹æ¯”åŒº */}
              <div ref={containerRef} className="flex-1 overflow-auto custom-scrollbar scroll-smooth">
                <div className="min-w-[800px] w-full flex flex-col font-mono text-sm">
                    {/* æ‚¬æµ®è¡¨å¤´ */}
                    <div className="flex sticky top-0 bg-gray-100 border-b border-gray-300 shadow-sm z-10 text-gray-600 font-semibold text-xs uppercase tracking-wider">
                        <div className="w-1/2 flex px-4 py-2 border-r border-gray-300">{titleA}</div>
                        <div className="w-1/2 flex px-4 py-2">{titleB}</div>
                    </div>
                    
                    {/* å¯¹é½çš„å·®å¼‚è¡Œ */}
                    {diffRows.map((row, idx) => (
                        <div key={idx} className="flex border-b border-gray-100/50 last:border-0 hover:bg-gray-50/80 transition-colors">
                            {/* å·¦é¢æ¿ */}
                            <div className={`w-1/2 flex border-r border-gray-200 ${row.left?.type === 'removed' ? 'bg-red-50 text-red-800' : 'text-gray-700'}`}>
                                <div className="w-12 shrink-0 bg-gray-50 border-r border-gray-200 text-right pr-2 py-1 text-xs text-gray-400 select-none">
                                    {row.leftNum}
                                </div>
                                <div className="px-3 py-1 whitespace-pre overflow-hidden text-ellipsis flex-1">
                                    {row.left ? row.left.value : ' '}
                                </div>
                            </div>
                            {/* å³é¢æ¿ */}
                            <div className={`w-1/2 flex ${row.right?.type === 'added' ? 'bg-green-50 text-green-800' : 'text-gray-700'}`}>
                                <div className="w-12 shrink-0 bg-gray-50 border-r border-gray-200 text-right pr-2 py-1 text-xs text-gray-400 select-none">
                                    {row.rightNum}
                                </div>
                                <div className="px-3 py-1 whitespace-pre overflow-hidden text-ellipsis flex-1">
                                    {row.right ? row.right.value : ' '}
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
              </div>

              {/* å³ä¾§ Minimap å·®å¼‚æ¦‚è§ˆæ»šåŠ¨æ¡ */}
              <div 
                  className="w-4 bg-gray-50 border-l border-gray-200 shrink-0 relative cursor-pointer hover:bg-gray-200 transition-colors z-10"
                  onClick={handleMinimapClick}
                  title="ç‚¹å‡»å¿«é€Ÿè·³è½¬è‡³å·®å¼‚ä½ç½®"
              >
                  {diffRows.map((row, idx) => {
                      const isLeftRemoved = row.left?.type === 'removed';
                      const isRightAdded = row.right?.type === 'added';
                      
                      if (!isLeftRemoved && !isRightAdded) return null; // ç›¸åŒè¡Œä¸ç»˜åˆ¶é¢œè‰²

                      let bgColor = '';
                      if (isLeftRemoved && isRightAdded) bgColor = 'bg-blue-400'; // åŒè¡Œä¿®æ”¹ä¸ºè“è‰²
                      else if (isLeftRemoved) bgColor = 'bg-red-400';             // åˆ é™¤ä¸ºçº¢è‰²
                      else if (isRightAdded) bgColor = 'bg-green-400';            // æ–°å¢ä¸ºç»¿è‰²

                      return (
                          <div 
                              key={idx}
                              className={`absolute w-full opacity-80 ${bgColor}`}
                              style={{ 
                                  top: `${(idx / diffRows.length) * 100}%`,
                                  height: `${Math.max(1, 100 / diffRows.length)}%`,
                                  minHeight: '3px' // ä¿è¯å•è¡Œä¹Ÿèƒ½çœ‹æ¸…
                              }}
                          />
                      );
                  })}
              </div>
            </div>
          )}
        </div>
      );
    };

    const JsonDiff = ({ showToast }) => <DiffTool showToast={showToast} mode="json" />;
    const XmlDiff = ({ showToast }) => <DiffTool showToast={showToast} mode="xml" />;

    const JsonToJava = ({ showToast }) => {
      const [input, setInput] = useState('');
      const [output, setOutput] = useState('');
      const [className, setClassName] = useState('RootEntity');

      const handleGenerate = () => {
        if (!input.trim()) {
          showToast("JSON ä¸èƒ½ä¸ºç©º", "error");
          return;
        }
        try {
          const code = generateJavaClass(input, className || "RootEntity");
          setOutput(code);
          showToast("å®ä½“ç±»ç”ŸæˆæˆåŠŸ", "success");
        } catch (err) {
          showToast(err.message, "error");
        }
      };

      return (
        <div className="flex flex-col h-full space-y-4">
          <div className="flex flex-wrap items-center gap-3 bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
            <span className="text-gray-600 text-sm font-medium">æ ¹ç±»å:</span>
            <input 
              type="text" 
              value={className}
              onChange={(e) => setClassName(e.target.value)}
              className="bg-gray-50 border border-gray-300 text-gray-800 px-3 py-1.5 rounded-md focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-sm"
              placeholder="RootEntity"
            />
            <Button onClick={handleGenerate} icon="coffee" variant="primary">ç”Ÿæˆ Java Bean</Button>
          </div>

          <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-4 min-h-0">
            <TextAreaPanel label="JSON è¾“å…¥åŒº" value={input} onChange={(e) => setInput(e.target.value)} placeholder="è¾“å…¥æ‚¨çš„ JSON æ¥å£æŠ¥æ–‡..." />
            <TextAreaPanel 
              label="Java å®ä½“ç±»è¾“å‡ºåŒº" 
              value={output} 
              readOnly 
              placeholder="ç”Ÿæˆçš„ Java class ä»£ç å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."
              extraAction={
                <button onClick={() => copyToClipboard(output, () => showToast("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", "success"), () => showToast("å¤åˆ¶å¤±è´¥", "error"))} className="text-gray-400 hover:text-blue-600 transition-colors">
                  <i className="fas fa-copy"></i>
                </button>
              }
            />
          </div>
        </div>
      );
    };

    const DevTools = ({ showToast }) => {
      const [input, setInput] = useState('');
      const [output, setOutput] = useState('');

      const processText = async (type) => {
        if (!input) return;
        try {
          let res = '';
          switch (type) {
            case 'b64encode': res = btoa(unescape(encodeURIComponent(input))); break;
            case 'b64decode': res = decodeURIComponent(escape(atob(input))); break;
            case 'urlencode': res = encodeURIComponent(input); break;
            case 'urldecode': res = decodeURIComponent(input); break;
            case 'sha256':
              if (!window.isSecureContext && window.location.protocol !== 'file:') {
                 throw new Error("SHA-256 éœ€è¦åœ¨ HTTPS æˆ–æœ¬åœ°ç¯å¢ƒä¸‹è¿è¡Œ");
              }
              const msgBuffer = new TextEncoder().encode(input);
              const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
              const hashArray = Array.from(new Uint8Array(hashBuffer));
              res = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
              break;
            default: break;
          }
          setOutput(res);
          showToast("æ‰§è¡ŒæˆåŠŸ", "success");
        } catch (e) {
          showToast(`å¤„ç†å¤±è´¥: ${e.message || "è¯·æ£€æŸ¥è¾“å…¥æ ¼å¼"}`, "error");
        }
      };

      return (
        <div className="flex flex-col h-full space-y-4 max-w-5xl mx-auto w-full">
          <div className="grid grid-cols-2 sm:grid-cols-5 gap-2">
            <Button onClick={() => processText('b64encode')} variant="secondary">Base64 ç¼–ç </Button>
            <Button onClick={() => processText('b64decode')} variant="secondary">Base64 è§£ç </Button>
            <Button onClick={() => processText('urlencode')} variant="secondary">URL ç¼–ç </Button>
            <Button onClick={() => processText('urldecode')} variant="secondary">URL è§£ç </Button>
            <Button onClick={() => processText('sha256')} variant="primary" icon="shield-halved">SHA-256 å“ˆå¸Œ</Button>
          </div>

          <div className="flex flex-col space-y-4 flex-1 min-h-0">
            <div className="flex-1">
              <TextAreaPanel label="å¾…å¤„ç†æ–‡æœ¬" value={input} onChange={(e) => setInput(e.target.value)} placeholder="åœ¨æ­¤è¾“å…¥éœ€è¦ç¼–ç /è§£ç /å“ˆå¸Œçš„å­—ç¬¦ä¸²..." />
            </div>
            <div className="flex justify-center items-center py-1">
              <div className="w-8 h-8 rounded-full bg-white border border-gray-200 shadow-sm flex items-center justify-center">
                <i className="fas fa-arrow-down text-gray-400"></i>
              </div>
            </div>
            <div className="flex-1">
              <TextAreaPanel 
                label="å¤„ç†ç»“æœ" 
                value={output} 
                readOnly 
                placeholder="è®¡ç®—ç»“æœ..." 
                extraAction={
                  <button onClick={() => copyToClipboard(output, () => showToast("å¤åˆ¶æˆåŠŸ", "success"), () => showToast("å¤åˆ¶å¤±è´¥", "error"))} className="text-gray-400 hover:text-blue-600 transition-colors">
                    <i className="fas fa-copy"></i>
                  </button>
                }
              />
            </div>
          </div>
        </div>
      );
    };

    // --- ä¸»åº”ç”¨ç»„ä»¶ ---

    function App() {
      const [activeTab, setActiveTab] = useState('json');
      const [toast, setToast] = useState(null);

      const showToast = (message, type = 'info') => {
        setToast({ message, type, id: Date.now() });
      };

      const tabs = [
        { id: 'json', label: 'JSON å…¨èƒ½å·¥å…·', icon: 'file-code' },
        { id: 'json-diff', label: 'JSON å¯¹æ¯” (Diff)', icon: 'file-signature' },
        { id: 'xml', label: 'XML å…¨èƒ½å·¥å…·', icon: 'file-lines' },
        { id: 'xml-diff', label: 'XML å¯¹æ¯” (Diff)', icon: 'code-compare' },
        { id: 'java', label: 'JSON è½¬ Java', icon: 'layer-group' },
        { id: 'tools', label: 'å¸¸ç”¨å¼€å‘å·¥å…·', icon: 'terminal' },
      ];

      return (
        <div className="min-h-screen bg-gray-50 text-gray-800 flex flex-col md:flex-row font-sans">
          
          {/* ä¾§è¾¹å¯¼èˆªæ  */}
          <aside className="w-full md:w-64 bg-white border-r border-gray-200 flex flex-col shrink-0 shadow-sm z-10">
            <div className="h-16 flex items-center px-6 border-b border-gray-200 shrink-0">
              <div className="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center mr-3 shadow-md shadow-blue-600/20">
                <i className="fas fa-code text-white"></i>
              </div>
              <h1 className="font-bold text-lg text-gray-800 tracking-wide">DevToolkit</h1>
            </div>
            
            <nav className="flex-1 overflow-y-auto py-4 px-3 space-y-1">
              {tabs.map((tab) => {
                const isActive = activeTab === tab.id;
                return (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className={`w-full flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-colors duration-200 ${
                      isActive 
                        ? 'bg-blue-50 text-blue-700' 
                        : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900'
                    }`}
                  >
                    <i className={`fas fa-${tab.icon} w-5 text-center mr-2 ${isActive ? 'text-blue-600' : 'text-gray-400'}`}></i>
                    {tab.label}
                  </button>
                );
              })}
            </nav>

            <div className="p-4 border-t border-gray-200 shrink-0 bg-gray-50/50">
              <div className="flex items-center text-xs text-gray-500">
                <i className="fas fa-shield-halved mr-2 text-green-500"></i>
                <span>çº¯æœ¬åœ°æµè§ˆå™¨è¿ç®—ï¼Œä¿éšœæ•°æ®å®‰å…¨</span>
              </div>
            </div>
          </aside>

          {/* ä¸»å†…å®¹åŒºåŸŸ */}
          <main className="flex-1 flex flex-col min-w-0 h-screen overflow-hidden bg-gray-50">
            
            {/* é¡¶éƒ¨æ ‡é¢˜æ  */}
            <header className="h-16 flex items-center px-6 border-b border-gray-200 shrink-0 bg-white shadow-sm z-0">
              <h2 className="text-xl font-semibold text-gray-800 flex items-center">
                {tabs.find(t => t.id === activeTab)?.label}
              </h2>
            </header>

            {/* å†…å®¹ä¸»ä½“ */}
            <div className="flex-1 p-4 md:p-6 overflow-hidden">
              {activeTab === 'json' && <JsonToolkit showToast={showToast} />}
              {activeTab === 'json-diff' && <JsonDiff showToast={showToast} />}
              {activeTab === 'xml' && <XmlToolkit showToast={showToast} />}
              {activeTab === 'xml-diff' && <XmlDiff showToast={showToast} />}
              {activeTab === 'java' && <JsonToJava showToast={showToast} />}
              {activeTab === 'tools' && <DevTools showToast={showToast} />}
            </div>
          </main>

          {/* æç¤ºç»„ä»¶ */}
          {toast && (
            <Toast 
              key={toast.id} 
              message={toast.message} 
              type={toast.type} 
              onClose={() => setToast(null)} 
            />
          )}
        </div>
      );
    }

    // æ¸²æŸ“åº”ç”¨
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
